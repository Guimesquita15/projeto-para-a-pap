<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Perfil</title>
    <link rel="icon" href="data:,">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { max-width: 400px; margin: auto; border: 1px solid #ccc; padding: 20px; border-radius: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="box">
        <h2>O Meu Perfil</h2>
        <label>Nome:</label><input type="text" id="nome">
        <label>Produtos:</label><input type="text" id="prods">
        <label>Telefone:</label><input type="tel" id="tel">
        <button onclick="salvar()">GUARDAR DADOS</button>
        <p><a href="index.html">Sair para o Mapa</a></p>
    </div>

    <script>
        const pid = localStorage.getItem('produtor_id');

        async function carregar() {
            if (!pid) { window.location.href = 'login.html'; return; }
            const res = await fetch(`http://127.0.0.1:5000/api/produtores/meus_dados/${pid}`);
            const d = await res.json();
            document.getElementById('nome').value = d.nome || "";
            document.getElementById('tel').value = d.telefone || "";
            document.getElementById('prods').value = d.produtos ? d.produtos.join(', ') : "";
        }

        async function salvar() {
            await fetch('http://127.0.0.1:5000/api/produtores/atualizar_perfil', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    id: pid,
                    nome: document.getElementById('nome').value,
                    telefone: document.getElementById('tel').value,
                    produtos: document.getElementById('prods').value.split(',').map(p => p.trim())
                })
            });
            alert("Guardado!");
        }
        carregar();
    </script>
</body>
</html>